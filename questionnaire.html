<!DOCTYPE html>
<html lang="en">
<head>
  <title>實驗後測問卷</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <script src="main.js"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-SS79Y419WQ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-SS79Y419WQ');
  </script>
  <style>
    .container{
      margin-top: 40px;
      /* border: 1px solid darkgrey; */
      border-radius: 4px;
      padding: 40px; 
      margin-bottom: 40px;
      background-color: rgb(250, 250, 250);
    }
    form{
      font-size: 20px;
    }
    .customalign{
      display: flex; 
      justify-content: space-between; 
    }
    .form-group{
      margin-top: 10px;
      margin-bottom: 20px;
    }
    .itemlabel{
      color: rgb(99, 99, 99);
    }
    input[type='radio'] {
      width:20px;
      height:20px;
    }
  </style>
</head>
<body>
    <div class="container">
      <form class="needs-validation" novalidate id="questionnaire">
        <div id="postQ">
          <h4 style="background-color: #FAB00C; color: white">請根據剛剛的互動體驗回答以下問題</h4>
          <b style="color:red">** 所有問題皆為必填選項</b>
          <div style="margin-top: 40px;">1-1 請問您認為機器人的互動風格為何？</div>
          <div class="form-group customalign">
            <label class="itemlabel">以完成工作任務為主</label>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="style" id="style1" value="1" required>
              <label class="form-check-label" for="style1"> 1</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="style" id="style2" value="2">
              <label class="form-check-label" for="style2"> 2</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="style" id="style3" value="3">
              <label class="form-check-label" for="style3"> 3</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="style" id="style4" value="4">
              <label class="form-check-label" for="style4"> 4</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="style" id="style5" value="5">
              <label class="form-check-label" for="style5"> 5</label>
            </div>
            <label class="itemlabel">與顧客進行社交互動為主</label>
          </div>
          <hr>
          <div class="proactivity"></div>
          <hr>
          <div class="intimacy"></div>
          <hr>
          <div class="cogTrust"></div>
          <hr>
          <div class="emoTrust"></div>
          <hr>
          <div class="intention"></div>        
          <hr>
          <div style="margin-top: 20px;">7 若有意願參加抽獎，請留下您完整的信箱地址</div>
          <input type="email" class="form-control form-group" id="email" name="email" placeholder="您的電子信箱">
        </div>

        <div style="text-align: center; margin-top: 40px;">
          <div id="novalid" style="color: red; display: none">您有未填選項</div>
          <button type="button" class="btn btn-outline-secondary" style="display: none;" id="previous" onclick="back()">上一頁</button>
          <!-- <button type="button" class="btn" style="background-color: #FAB00C; color: white;" id="next" onclick="demoShow()">下一頁</button> -->
          <button type="submit" class="btn" style="background-color: #FAB00C; color: white; width: 100%;" id="submit">送出</button>
        </div>
      </form>
      <button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#submitQ" id="showModal" hidden>Open Modal</button>
      <div class="modal fade" id="submitQ" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body" style="text-align: center;">
              <h4>送出問卷中，請稍候</h4>
          </div>
        </div>
      </div>
    </div>
</body>
<script>
  // Disable form submissions if there are invalid fields
  (function() {
    'use strict';
    window.addEventListener('load', function() {
      // Get the forms we want to add validation styles to
      var forms = document.getElementsByClassName('needs-validation');
      // Loop over them and prevent submission
      var validation = Array.prototype.filter.call(forms, function(form) {
        form.addEventListener('submit', function(event) {
          if (form.checkValidity() === false) {
            event.preventDefault();
            event.stopPropagation();
            document.getElementById('novalid').style.display = '';
          }else{
            event.preventDefault();
            event.stopPropagation();
            // window.location.href = 'success.html';
            document.getElementById('showModal').click();
            submitData();          }
          form.classList.add('was-validated');
        }, false);
      });
    }, false);
  })();

  function demoShow(){
    document.getElementById('postQ').style.display = 'none';
    document.getElementById('demo').style.display = '';
    document.getElementById('previous').style.display = '';
    document.getElementById('next').style.display = 'none';
    document.getElementById('submit').style.display = '';
    window.document.documentElement.scrollTop = 0;
  }

  function back(){
    document.getElementById('postQ').style.display = '';
    document.getElementById('demo').style.display = 'none';
    document.getElementById('previous').style.display = 'none';
    document.getElementById('next').style.display = '';
    document.getElementById('submit').style.display = 'none';
  }

  $(function(){
    proactivityList = ["2-1 我認為機器人主動向顧客介紹商品", "2-2 我認為機器人主動幫助顧客解決所遇到的問題", "2-3 我認為機器人主動讓顧客瞭解如何操作頁面功能", "2-4 整體而言，我認為機器人主動向顧客提供服務"];
    intimacyList = ["3-1 我認為機器人會和顧客分享他的想法與情感", "3-2 我認為機器人對顧客是友善的", "3-3 我認為機器人試圖拉近與顧客的距離", "3-4 我認為機器人理解顧客的想法，知道顧客要什麼", "3-5 我認為機器人是關心顧客的"];
    cogTrustList = ["4-1 我認為機器人有能力並有效地與我互動", "4-2 我認為機器人很好地發揮了提供幫助的作用", "4-3 整體而言，我認為機器人是有能力和專業的", "4-4 總的來説，我認為機器人提供很多有用的資訊（資訊豐富的）", "4-5 我認為機器人是真實地對待我", "4-6 我覺得這個機器人是誠實的", "4-7 我認為機器人提供公正的產品推薦", "4-8 我認為機器人是正直的"];
    emoTrustList = ["5-1 在購物過程中，我對依靠機器人感到很自在", "5-2 在購物過程中，我對依靠機器人感到滿意"];
    intentionList = ["6-1 假設我可以再次遇到這樣的機器人，我打算使用他", "6-2 假設我可以再次遇到這樣的機器人，我預期我會使用他", "6-3我對未來再次使用這樣的機器人有很大的興趣"];

    var proactivityLength = proactivityList.length;
    var code = "P"
    for(var i = 1; i <= proactivityLength; i++){
      $(".proactivity").append('<div>'+ proactivityList[i-1] +'</div><div class="form-group customalign"><label class="itemlabel">非常不同意</label><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="'+ code +'_'+ i +'" id="'+ code +'_'+ i +'1" value="1" required><label class="form-check-label" for="'+ code +'_'+ i +'1"> 1</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="'+ code +'_'+ i +'" id="'+ code +'_'+ i +'2" value="2"><label class="form-check-label" for="'+ code +'_'+ i +'2"> 2</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="'+ code +'_'+ i +'" id="'+ code +'_'+ i +'3" value="3"><label class="form-check-label" for="'+ code +'_'+ i +'3"> 3</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="'+ code +'_'+ i +'" id="'+ code +'_'+ i +'4" value="4"><label class="form-check-label" for="'+ code +'_'+ i +'4"> 4</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="'+ code +'_'+ i +'" id="'+ code +'_'+ i +'5" value="5"><label class="form-check-label" for="'+ code +'_'+ i +'5"> 5</label></div><label class="itemlabel">非常同意</label>');
    }

    var intimacyLength = intimacyList.length;
    var code = "I"
    for(var i = 1; i <= intimacyLength; i++){
      $(".intimacy").append('<div>'+ intimacyList[i-1] +'</div><div class="form-group customalign"><label class="itemlabel">非常不同意</label><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="'+ code +'_'+ i +'" id="'+ code +'_'+ i +'1" value="1" required><label class="form-check-label" for="'+ code +'_'+ i +'1"> 1</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="'+ code +'_'+ i +'" id="'+ code +'_'+ i +'2" value="2"><label class="form-check-label" for="'+ code +'_'+ i +'2">2</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="'+ code +'_'+ i +'" id="'+ code +'_'+ i +'3" value="3"><label class="form-check-label" for="'+ code +'_'+ i +'3"> 3</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="'+ code +'_'+ i +'" id="'+ code +'_'+ i +'4" value="4"><label class="form-check-label" for="'+ code +'_'+ i +'4">4</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="'+ code +'_'+ i +'" id="'+ code +'_'+ i +'5" value="5"><label class="form-check-label" for="'+ code +'_'+ i +'5">5</label></div><label class="itemlabel">非常同意</label></div>');
    }

    var cogTrustLength = cogTrustList.length;
    var code = "CT"
    for(var i = 1; i <= cogTrustLength; i++){
      $(".cogTrust").append('<div>'+ cogTrustList[i-1] +'</div><div class="form-group customalign"><label class="itemlabel">非常不同意</label><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="'+ code +'_'+ i +'" id="'+ code +'_'+ i +'1" value="1" required><label class="form-check-label" for="'+ code +'_'+ i +'1"> 1</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="'+ code +'_'+ i +'" id="'+ code +'_'+ i +'2" value="2"><label class="form-check-label" for="'+ code +'_'+ i +'2">2</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="'+ code +'_'+ i +'" id="'+ code +'_'+ i +'3" value="3"><label class="form-check-label" for="'+ code +'_'+ i +'3"> 3</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="'+ code +'_'+ i +'" id="'+ code +'_'+ i +'4" value="4"><label class="form-check-label" for="'+ code +'_'+ i +'4">4</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="'+ code +'_'+ i +'" id="'+ code +'_'+ i +'5" value="5"><label class="form-check-label" for="'+ code +'_'+ i +'5">5</label></div><label class="itemlabel">非常同意</label></div>');
    }

    var emoTrustLength = emoTrustList.length;
    var code = "ET"
    for(var i = 1; i <= emoTrustLength; i++){
      $(".emoTrust").append('<div>'+ emoTrustList[i-1] +'</div><div class="form-group customalign"><label class="itemlabel">非常不同意</label><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="'+ code +'_'+ i +'" id="'+ code +'_'+ i +'1" value="1" required><label class="form-check-label" for="'+ code +'_'+ i +'1"> 1</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="'+ code +'_'+ i +'" id="'+ code +'_'+ i +'2" value="2"><label class="form-check-label" for="'+ code +'_'+ i +'2">2</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="'+ code +'_'+ i +'" id="'+ code +'_'+ i +'3" value="3"><label class="form-check-label" for="'+ code +'_'+ i +'3"> 3</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="'+ code +'_'+ i +'" id="'+ code +'_'+ i +'4" value="4"><label class="form-check-label" for="'+ code +'_'+ i +'4">4</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="'+ code +'_'+ i +'" id="'+ code +'_'+ i +'5" value="5"><label class="form-check-label" for="'+ code +'_'+ i +'5">5</label></div><label class="itemlabel">非常同意</label></div>');
    }

    var intentionLength = intentionList.length;
    var code = "INT"
    for(var i = 1; i <= intentionLength; i++){
      $(".intention").append('<div>'+ intentionList[i-1] +'</div><div class="form-group customalign"><label class="itemlabel">非常不同意</label><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="'+ code +'_'+ i +'" id="'+ code +'_'+ i +'1" value="1" required><label class="form-check-label" for="'+ code +'_'+ i +'1"> 1</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="'+ code +'_'+ i +'" id="'+ code +'_'+ i +'2" value="2"><label class="form-check-label" for="'+ code +'_'+ i +'2">2</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="'+ code +'_'+ i +'" id="'+ code +'_'+ i +'3" value="3"><label class="form-check-label" for="'+ code +'_'+ i +'3"> 3</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="'+ code +'_'+ i +'" id="'+ code +'_'+ i +'4" value="4"><label class="form-check-label" for="'+ code +'_'+ i +'4">4</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="'+ code +'_'+ i +'" id="'+ code +'_'+ i +'5" value="5"><label class="form-check-label" for="'+ code +'_'+ i +'5">5</label></div><label class="itemlabel">非常同意</label></div>');
    }
  });


  // $('#submit').on('click', function() 
  function submitData(){
    var formData = $('#questionnaire').serializeArray();
    // var dataList = JSON.stringify(formData);
    //console.log(formData);
    var data = {};
    var condition = localStorage.getItem('condition');
    var today = new Date();
    var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate()+' '+today.toTimeString();
    var distance = localStorage.getItem('endTime') - localStorage.getItem('startTime');
    var hours = Math.floor(distance / 3600000);
    distance -= hours * 3600000;
    var minutes = Math.floor(distance / 60000);
    distance -= minutes * 60000;
    var seconds = Math.floor(distance / 1000);
    var period = hours+':'+minutes+':'+seconds;
    data["qTime"] = date;
    data["condition"] = condition;
    data["persona"] = localStorage.getItem('persona');
    data['viewSource'] = localStorage.getItem('viewSource');
    data["source"] = localStorage.getItem('source');
    data["addProduct"] = localStorage.getItem('addProduct');
    data["getRecommend"] = localStorage.getItem('getRecommend');
    data["getOther"] = localStorage.getItem('getOther');
    data["period"] = period;

    for (i = 0; i < formData.length; i++){
      keyname = formData[i]["name"];
      value = formData[i]["value"];
      data[keyname] = value;
    }
    console.log(data);

    var dataList = localStorage.getItem('dataList').split(",");
    for (i = 0; i < dataList.length - 1; i = i + 2){
      keyname = dataList[i];
      value = dataList[i+1];
      data[keyname] = value;
    }

    $.get(
      'https://script.google.com/macros/s/AKfycbwYRjrmAQj7Pg6MSQRwWpOKuPEB-i0ItlCDaPgkIHa5Dc_Fnt0-rOY49URvrhECl-90og/exec', 
      data,
      function(response) {
        if(response == "成功"){
          console.log(date);
          console.log(period);
          window.location.href = 'success.html';
          // localStorage.clear();
        }
        else{
          alert("很抱歉！請再次嘗試送出問卷，謝謝。");
        }
      }
    );

  }
</script>
</html>