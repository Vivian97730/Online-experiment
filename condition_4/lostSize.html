<!DOCTYPE html>
<html lang="en">
<head>
  <title>Pepper Shoe - 詢問尺寸</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <script src="../main.js"></script>
  <link rel="stylesheet" href="../main.css">
  <link href="https://vjs.zencdn.net/7.11.4/video-js.css" rel="stylesheet" />
  <script src="https://vjs.zencdn.net/7.11.4/video.min.js"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-SS79Y419WQ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-SS79Y419WQ');
  </script>
  <style>
    .nosize{
      padding: 10px; 
      background-color: rgb(226, 226, 226); 
      border-radius: 5px; 
      font-size: 18px; 
      color: white;
      margin-right: 10px;
    }
    .sizeleft{
      padding: 10px; 
      background-color: white; 
      color: black;
      border: solid 1px darkgrey; 
      border-radius: 5px; 
      font-size: 18px;
      margin-right: 10px;
    }
    .price{
      /* font-size: 16px;  */
      color: #FAB00C; 
      font-weight: bold; 
      margin-left: 20px;
    }
    .card{
      width: 32%;
      cursor: auto;
      margin-right: 1%;
    }

  </style>
</head>

<body>
  <div class="row" style="margin-top: 1%;">
    <div style="margin-left: 3%;" id="taskInfo"></div>
  </div>
  <div class="videoRemind">***請觀看完整影片，再於右方畫面中進行互動***</div>
  <div class="row">
    <div class="col-md-3" id="videoDisplay" style="z-index: 999;"></div>
    <div class="col-md-9" style="overflow: auto; border: 1px solid lightgrey;">
      <div class="row">
        <div class = "col-sm-6" style = "font-size: 2em; padding: 0 20px;">
          <a href="index.html">Pepper Shoe</a>
        </div>
        <div class = "col-sm-6" style = "padding-top: 10px;">
          <ul class = "head-list" id="head">
            <li>
              <a href="funcSelect.html">
                <img src="../img/menu.png" alt="" width="25px">
                <span style="margin-left: 10px;">功能選單</span>
              </a>
            </li>
            <li id="iflogin" style="display: none;">
              <img src="../img/user.png" alt="" width="30px" style="margin-left: 40px"><span id="username" style="margin-left: 30px;"></span>
            </li>
            <li id="nologin" style="display: none;">
              <button onclick="route('register.html')" class = "btn btn-outline-secondary" style="margin-left: 30px;" >會員註冊</button>
            </li>
          </ul>
        </div>
      </div>

      <div style = "background-color: rgb(50, 49, 49); margin-top: 0.5%;">
        <ul class = "nav nav-pills nav-fill">
          <li class = "nav-item dropdown">
            <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">運動分類</a>
            <div class="dropdown-menu">
              <a class="dropdown-item" href="./category.html?category=run">慢跑</a>
              <a class="dropdown-item" href="./category.html?category=hiking">登山健行</a>
              <a class="dropdown-item" href="./category.html?category=basketball">籃球</a>
            </div>
          </li>
          <li class = "nav-item" >
            <a class="nav-link" href="./hotProduct.html">熱銷商品</a>
          </li>
          <li class = "nav-item">
            <a class="nav-link" href="./allProduct.html">全部商品</a>
          </li>
        </ul>
      </div>

      <div class="container-fluid">
        <a href="javascript:history.back()">
          <div style="margin-top: 20px; font-size: 20px;">
            < 回上頁
          </div>
        </a>
        <!-- <div style="margin-top: 5%; border: 1px solid lightgray; border-radius: 5px; padding: 1%; text-align: center;" id="submitInfo">
          送出成功！
        </div> -->
        <div id="lostContent">
          <div class="row" style="margin-top: 3%;" >
            <div class="col-sm-6" id="productimg"></div>
            <div class="col-sm-6" style="padding-left: 20px; word-break:break-all">
              <h4 id="name"></h4><br>
              <h5 id="wait">確認店內庫存中，請稍候</h5>
              <div id="size" style="display: none;">
                <p style="margin-top: 30px;">
                  剩餘尺寸：
                </p>
                <p id="sizeinfo" style="margin-top: 30px;"></p>
                <button type="button" class="btn btn-lg" style="background-color: #FAB00C; color: white; width: 100%; margin-top: 12%;" onclick="javascript:document.getElementById('showModal').click()">看看推薦商品</button>
              </div>
            </div>
          </div>
        </div>
        <button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#recommendmodal" id="showModal" hidden>Open Modal</button>
        <div class="modal fade" id="recommendmodal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"width="80%">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                推薦商品列表
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span>&times;</span>
                </button>
              </div>
              <div class="modal-body" id="recommendProduct" style="text-align: center;"></div>
              <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-dismiss="modal" onclick="other()">看看其他商品</button>
                <button type="button" class="btn" style="background-color: #FAB00C; color: white" onclick="recommend()"> 前往推薦商品</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
    
​<script>
  // var productCategory = localStorage.getItem('findCategory');
  // var productId = localStorage.getItem('findpid');
  var productCategory = window.location.search.split('=')[1].split('&')[0];
  var productId = window.location.search.split('=')[2];
  localStorage.setItem('getLost', 1);

  $(function() {        
    $.get('https://spreadsheets.google.com/feeds/list/1Ai3QhD8590Uip6TCRmXm_fArYAeYQP4tc5a20_EfL6Y/1/public/values?alt=json', function(data) {
      console.log(data);
      var d = data.feed.entry;
      var item = {};

      for(var i in d) {
        if(d[i].gsx$category.$t == productCategory && d[i].gsx$id.$t == productId){
          item.category = d[i].gsx$category.$t;
          item.id = d[i].gsx$id.$t;
          item.name = d[i].gsx$name.$t;
          item.imglink = d[i].gsx$imglink.$t;
          item.size = d[i].gsx$size.$t;
          item.sizeleft = d[i].gsx$sizeleft.$t;
        }
      }
      sizeList = item.size.split(',');
      sizeleftList = item.sizeleft.split(',');
      console.log(sizeleftList);
      
      $('#productimg').append('<img src="'+item.imglink+'" alt="..." width="240px" style="display: block; margin-left: auto; margin-right: auto;">');
      $('#name').text(item.name);
      for(var i in sizeList){
        $('#sizeinfo').append('<span id="'+sizeList[i]+'">'+sizeList[i]+'</span>');
        for(var j in sizeleftList){
          if (sizeList[i] == sizeleftList[j]){
            $('#'+sizeList[i]).addClass('sizeleft');
          }else{
            $('#'+sizeList[i]).addClass('nosize');
          }
        }
      }

      var recommendList = localStorage.getItem('recommendList');
      if(recommendList == null){
        var recommendList = ['1','3','5'];
        localStorage.setItem('recommendList', recommendList)
      }
      var r = data.feed.entry;
      var ritems = [];

      for(var i in d) {
        var ritem = {};
        if(recommendList.indexOf(r[i].gsx$id.$t) != -1){
          if(r[i].gsx$id.$t == productId){
            continue
          }else{
            ritem.category = r[i].gsx$category.$t;
            ritem.id = r[i].gsx$id.$t;
            ritem.name = r[i].gsx$name.$t;
            ritem.imglink = r[i].gsx$imglink.$t;
            ritem.price = r[i].gsx$price.$t;

            ritems.push(ritem);
          }
        }
      }
      
      for(var i in ritems) {
        if(ritems[i].category == productCategory){
          if(productCategory != 'basketball'){
            var pname = ritems[i].name.split(' ')[0];
          }else{
            var pname = ritems[i].name;
          }
          var Card = '<div class="card"><img src="'+ritems[i].imglink+'" class="card-img-top"><div class="card-body"><p class="card-title">'+pname+'</p><span class="card-text"> NT '+ritems[i].price+'</span></div></div>';
          $('#recommendProduct').append(Card);
        } 
      }
    });
    var videoTime;
    document.getElementById('videoid').ontimeupdate = function(){
      videoTime = document.getElementById('videoid').currentTime;
      if(videoTime > '7'){
        showSize();
      }
      else if(videoTime > '14.5' && videoTime < '14.9'){ 
        console.log(videoTime);
        document.getElementById('showModal').click();
      }
    }
  });

  function other(){
    localStorage.setItem('viewOther', 1);
    window.location.href = "./category.html?category="+productCategory;
  }


  function showSize(){
    document.getElementById('wait').style.display = 'none';
    // document.getElementById('sizetitle').style.display = 'block';
    document.getElementById('size').style.display = 'block';
    // setTimeout("document.getElementById('showModal').click()", 10000);
  }

  function recommend(){
    localStorage.setItem('viewRecommend', 1);
    window.location.href = "./recommend.html";
  }


  // setTimeout('showSize();', 6000);
  // setTimeout("document.getElementById('submitInfo').style.display = 'none'", 5000);
  // setTimeout("document.getElementById('lostContent').style.display = ''", 5000);

  var lostLink = '../video/intimate/'+productCategory+productId+'/'+productCategory+productId+'_lostSize_AI.mp4';
  $("#videoDisplay").html('<video width="100%" controls autoplay id="videoid"><source src="'+lostLink+'" type="video/mp4" id=""></video>');

  var pCategory = localStorage.getItem('productCategory');
  var pName = localStorage.getItem('productName');
  var selection = '';
  if(pCategory == 'run'){
    var cate = '慢跑';
  }else if(pCategory == 'hiking'){
    var cate = '登山健行';
  }else{
    var cate = '籃球';
  }

  if (pName != null && pCategory != null){
    selection = '而您目前選擇的是'+cate+'鞋 ['+pName+']'
  }else{
    selection = '而您目前尚未選擇商品'
  }

  var persona = localStorage.getItem('persona');
  if(persona == 0){
    $('#taskInfo').append('<p>任務說明：為喜歡爬山的 Anna 挑選禮物，<b>'+selection+'</b></p>');
  }else{
    $('#taskInfo').append('<p>任務說明：為喜歡在球場馳騁的 Andy 挑選禮物，<b>'+selection+'</b></p>');
  }
</script>
</body>
</html>
​
